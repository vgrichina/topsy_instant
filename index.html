<html>
<head>
    <title>Topsy Instant &ndash; realtime search in Twitter, based on Topsy</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="main.css">
</head>
<body>
    <div class="requestForm">
        <input type="text" id="query">
    </div>
    <div class="searchResults">
        <div class="item" style="display: none;">
            <a class="headerLink" href="http://example.com">Example link</a>
            <div class="url">example.com</div>
            <div class="text">This is some example text</div>
            <div class="info">
                <span class="user">
                    <img src="http://a1.twimg.com/profile_images/1124040897/at-twitter_bigger.png">
                    <a href="http://topsy.com/twitter/twitter">twitter</a>
                </span>
                <span class="date">
                    3 days ago
                </span>
                <span class="tweets">
                    <a href="http://topsy.com/example.com">123 more</a>
                </span>
            </div>
        </div>
    </div>
    <script>
        function search(query) {
            $.getJSON("http://otter.topsy.com/search.js?q=" + query + "&callback=?", function(data) {
                // Clear search results
                $(".searchResults .item:visible").remove();

                // Loop through all received items
                $.each(data.response.list, function(i, item) {
                    // Create item element from template
                    var template = $(".searchResults .item:first-child");
                    var itemElement = template.clone().appendTo(".searchResults");
                    // Populate item element
                    itemElement.find(".headerLink").attr("href", item.url);
                    itemElement.find(".headerLink").text(item.title);
                    itemElement.find(".url").text(item.url);
                    itemElement.find(".text").html(item.highlight);
                    // Show item element
                    itemElement.show();
                });
            });
        }

        // Handle keypresses in query field
        $("#query").keypress(function() {
            // Executing code with timeout, so that field value is already updated
            setTimeout(function() {
                var query = $("#query").val();
                if (query.length > 0) {
                    search(query);
                }
            }, 100);
        });

    </script>
</body>
</html>
